<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Blam</title>
        <meta name="description" content="dscription">
        <meta name="keywords" content="this">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap" rel="stylesheet">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Ubuntu+Mono:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
        <link rel="icon" href="/ico/favicon.ico" type="image/x-icon">
        <link rel="shortcut icon" href="/ico/favicon.ico" type="image/x-icon">
        <link rel="stylesheet" href="/css/index.css">
        <script src="/lib/lexi/lexi-wasm.js"></script>
        <script src="/lib/lexi/lexi.js"></script>
    </head>
    <body>
        <div class="nav">
            <div class="nav__brand">
                <img class="nav__brand__image" src="/svg/logo.svg" />
            </div>
            <div class="nav__links">
                <a class="nav__link__active" href="/">Docs</a>
                <a class="nav__link" href="/">Community</a>
                <a class="nav__link" href="/">Roadmap</a>
            </div>
            <div class="nav__grow"></div>
            <div class="nav__utils">
                <button class="nav__search__button">
                    {{template "partials/search" .}}
                    <div class="nav__search__text">
                        Search
                    </div>
                </button>
            </div>
        </div>
        <div class="main">
            <div class="menu">
                <div class="menu__header">Bloop</div>
                <a href="/bloop" class="menu__button">Bloop Package Manager</a>
                <div class="menu__header">Common Concepts</div>
                <a href="/comments" class="menu__button">Comments</a>
                <a href="/variables" class="menu__button">Variables</a>
                <a href="/data_types" class="menu__button">Data Types</a>
                <a href="/control_flow" class="menu__button">Control Flow</a>
                <a href="/functions" class="menu__button">Functions</a>
                <div class="menu__header">Structs</div>
                <a href="/structs" class="menu__button">Structs</a>
                <div class="menu__header">Standard Library</div>
                <a href="/" class="menu__button">argparse</a>
                <a href="/" class="menu__button">fs</a>
                <a href="/" class="menu__button">os</a>
                <a href="/" class="menu__button">io</a>
                <a href="/" class="menu__button">http</a>
                <a href="/" class="menu__button">json</a>
                <a href="/" class="menu__button">re</a>
            </div>
            <div class="content">
                {{embed}}
            </div>
        </div>
        <script>
            const codeBlocks = document.querySelectorAll( '.content__code' )

            const rules = [
                ["STRING", "\"[a-zA-Z0-9\\s\\}]*\""],
                ["SINGLE_LINE_COMMENT", "\\/\\/[\\sa-zA-Z0-9]*\n+"],
                ["MULTI_LINE_COMMENT", "\\/\\*\n*[\\sa-zA-Z0-9]*\\*\\/"],
                ["L_DELIMETER", "\\("],
                ["R_DELIMETER", "\\)"],
                ["L_CURLY_DELIMETER", "\\{"],
                ["R_CURLY_DELIMETER", "\\}"],
                ["L_SQUARE_DELIMETER", "\\["],
                ["R_SQUARE_DELIMETER", "\\]"],
                ["OP_ARROW", "\\->"],
                ["OP_DOT", "\\."],
                ["OP_PLUS", "\\+"],
                ["OP_MINUS", "\\-"],
                ["OP_EQUALS", "="],
                ["OP_SLASH", "/"],
                ["KEYWORD", "return|if|for|while"],
                ["TYPE", "i8|i16|bool"],
                ["SPACE", "\\s+"],
                ["NUM", "[0-9]+"]
            ]

            const color = ( tokenType ) => {
                switch( tokenType ) {
                    case "STRING":
                        return '#D5FF80'
                    case "SINGLE_LINE_COMMENT":
                        return '#b1b1b1'
                    case "L_DELIMETER":
                        return '#FFD173'
                    case "R_DELIMETER":
                        return '#FFD173'
                    case "L_CURLY_DELIMETER":
                        return '#FFD173'
                    case "R_CURLY_DELIMETER":
                        return '#FFD173'
                    case "L_SQUARE_DELIMETER":
                        return '#FFD173'
                    case "R_SQUARE_DELIMETER":
                        return '#FFD173'
                    case "OP_ARROW":
                        return '#FFAD66'
                    case "OP_DOT":
                        return '#FFAD66'
                    case "OP_PLUS":
                        return '#FFAD66'
                    case "OP_MINUS":
                        return '#FFAD66'
                    case "OP_EQUALS":
                        return '#FFAD66'
                    case "OP_SLASH":
                        return '#FFAD66'
                    case "KEYWORD":
                        return '#FFAD66'
                    case "TYPE":
                        return '#DFBFFF'
                    case "NUM":
                        return '#DFBFFF'
                    default:
                        return '#b1b1b1'
                }
            }

            Array.from( codeBlocks ).forEach( element => {
                const src = element.textContent

                console.log( src )

                const lexi = new Lexi( src, rules, ( tokens ) => {
                    // reset text content
                    element.textContent = ""

                    console.log( tokens )

                    Array.from( tokens ).forEach( token => {
                        let tokenType = token.name
                        const start = token.start
                        const end = token.end - token.start
                        const fragmentText = src.substr( start, end )

                        const span = document.createElement( 'span' )
                        span.style.color = color( tokenType )
                        span.textContent = fragmentText

                        element.appendChild( span )

                        console.log( fragmentText )
                    })
                })
            })
        </script>
    </body>
</html>